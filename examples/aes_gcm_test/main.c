/* this file gets replaced with our own driver when we grade your submission.
 * So do what you want here but realize it won't persist when we grade it.
 */

#include <stdio.h>
#include <string.h>
#include <stdint.h>
#include <string.h>

#include "os.h"

int aes_gcm_ae(const u8 *key, size_t key_len, const u8 *iv, size_t iv_len,
	       const u8 *plain, size_t plain_len,
	       const u8 *aad, size_t aad_len, u8 *crypt, u8 *tag);

void hexdump(void *ptr, int buflen)
{
    unsigned char *buf = (unsigned char*)ptr;
    int i, j;
    for (i = 0; i < buflen; i += 16)
    {
        for (j=0; j<16; j++)
        {
            if (i+j < buflen)
                printf("%02x ", buf[i+j]);
            else
                printf("   ");
        }
        printf(" ");
        printf("\n");
    }
}

int main()
{ 
  const unsigned char key[16]={0xfe,0xff,0xe9,0x92,0x86,0x65,0x73,0x1c,0x6d,0x6a,0x8f,0x94,0x67,0x30,0x83,0x08};
  const unsigned char IV[12] ={0xca,0xfe,0xba,0xbe,0xfa,0xce,0xdb,0xad,0xde,0xca,0xf8,0x88};
  const unsigned char plaintext[]={0xd9,0x31,0x32,0x25,0xf8,0x84,0x06,0xe5,0xa5,0x59,0x09,0xc5,0xaf,0xf5,0x26,0x9a,0x86,0xa7,0xa9,0x53,0x15,0x34,0xf7,0xda,0x2e,0x4c,0x30,0x3d,0x8a,0x31,0x8a,0x72,0x1c,0x3c,0x0c,0x95,0x95,0x68,0x09,0x53,0x2f,0xcf,0x0e,0x24,0x49,0xa6,0xb5,0x25,0xb1,0x6a,0xed,0xf5,0xaa,0x0d,0xe6,0x57,0xba,0x63,0x7b,0x39,0x1a,0xaf,0xd2,0x55};
  const unsigned char add_data[16]={0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
  
  unsigned int len_p = sizeof(plaintext);
  unsigned int len_ad = 0;
  
  unsigned char *ciphertext = malloc(len_p);
  unsigned char tag[16]={0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
  
  //aes128gcm(ciphertext, tag, key, IV, plaintext, len_p, add_data, len_ad);
  
  //int i = aes_gcm_ae(key, 16, IV, 12, plaintext, len_p, add_data, len_ad, ciphertext, tag);
  
  int i = aes_gcm_ae(key, 16, IV, 12, plaintext, len_p, add_data, len_ad, ciphertext, tag);

  hexdump( ciphertext, len_p);
  
  // NIST test vector 3, authentication tag must be 4d 5c 2a f3 27 cd 64 a6 2c f3 5a bd 2b a6 fa b4
  printf("TAG: "); hexdump( tag, 16);
  
  free(ciphertext);

	return 0;
}

