/*
 * test_cosem_read_by_block.cpp
 *
 *  Created on: 3 nov. 2017
 *      Author: anthony
 */

#include "os_util.h"
#include "hdlc.h"

#include "catch.hpp"
#include <iostream>
#include <cstdlib>
#include <cstring>




void FirstBlockDecoder()
{
    static const char first_block[] = "C402C10000000001008201F40601001B0800FF15000000000000000002020F0016200203090601001C0800FF15000000000000000002020F0016200203090601001D0800FF15000000000000000002020F00161F0203090601001E0800FF15000000000000000002020F00161F020309060100290800FF15000000000000000002020F00161E0203090601002A0800FF15000000000000000002020F00161E0203090601002B0800FF15000000000000000002020F0016200203090601002C0800FF15000000000000000002020F0016200203090601002D0800FF15000000000000000002020F0016200203090601002E0800FF15000000000000000002020F0016200203090601002F0800FF15000000000000000002020F001620020309060100300800FF15000000000000000002020F001620020309060100310800FF15000000000000000002020F00161F020309060100320800FF15000000000000000002020F00161F0203090601003D0800FF15000000000000000002020F00161E0203090601003E0800FF15000000000000000002020F00161E0203090601003F0800FF15000000000000000002020F001620020309060100400800FF15000000000000000002020F001620020309060100410800FF15000000000000000002020F001620020309060100420800FF15000000000000000002020F001620020309";

    // transform the hexadecimal string into an array of integers
    int sz = sizeof(first_block);

    size_t packet_size = sz/2U;
    uint8_t *packet = (uint8_t *) malloc(packet_size);

    if (packet != NULL)
    {
        int ret;
        uint8_t *packet_ptr = packet;

        hex2bin(first_block, (char *)packet, sz);


        free(packet);
    }
    else
    {
       printf("Cannot allocate memory!\r\n");
    }

}


TEST_CASE( "COSEM_READ", "[Read by block]" )
{
    puts("\r\n--------------------------  COSEM TEST READ 1  --------------------------\r\n");
    FirstBlockDecoder();
}


